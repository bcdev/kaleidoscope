#!/usr/bin/env bash
#
# Copyright (c) Brockmann Consult GmbH, 2025
# License: MIT
#
set -e
## Produces Monte Carlo variants. Usage example:
#
#  ./kaleidoscope-run --source-type ghrsst source.nc
#
#  will produce variants
#
#  source.000.nc
#  source.001.nc
#  ...
#  source.010.nc
#
for selector in 000 001 002 003 004 005 006 007 008 009 010; do
  echo "$(tput setaf 2)$(date -u "+%Y-%m-%dT%H:%M:%S") [INFO] Selector ${selector} ...$(tput sgr0)"
  source_type="${1}"
  source_file="${2}"
  target_file="${2%.nc}"."${selector}".nc
  if [ -f "${target_file}" ]; then
    continue
  fi
  kaleidoscope \
    --selector ${selector} \
    --source-type "${source_type}" \
    --log-level warning \
    --progress \
    --stack-traces \
    "${source_file}" \
    "${target_file}"
done
